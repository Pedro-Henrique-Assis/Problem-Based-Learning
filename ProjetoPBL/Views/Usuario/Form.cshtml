@model UsuarioViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/cadastroUsuario.css" asp-append-version="true" />
}

<div class="container-externo-forms">

    <form action="Save" enctype="multipart/form-data" method="post">
        <div class="title">Realize o seu Cadastro!</div>

        <div class="form-body">
            <input type="hidden" name="Operacao" value="@ViewBag.Operacao" />

            @* <label for="Id">Id</label> *@
            @if (ViewBag.Operacao == "I")
            {
                <input asp-for="Id" type="hidden" readonly />
            }
            else
            {
                <input asp-for="Id" type="hidden" readonly />
            }
            <span asp-validation-for="Id"></span>
            <br />

            <label for="Nome">Insira o seu nome completo</label>
            <input asp-for="Nome" />
            <span asp-validation-for="Nome"></span>
            <br />

            <label for="Email">Insira o seu email</label>
            <input asp-for="Email" />
            <span asp-validation-for="Email"></span>
            <br />

            <label for="DataNascimento">Insira a sua data de nascimento</label>
            <input asp-for="DataNascimento" type="date" value="@Model.DataNascimento.ToString("yyyy-MM-dd")" />
            <span asp-validation-for="DataNascimento"></span>
            <br />

            <label for="SexoId">Selecione o seu gênero</label>
            <select asp-for="SexoId" asp-items="ViewBag.Sexos"> </select>
            <span asp-validation-for="SexoId"></span>
            <br />

            <label for="Cep">Insira o cep</label>
            <input asp-for="Cep" />
            <span asp-validation-for="Cep"></span>
            <br />

            <label for="Logradouro">Insira o endereço</label>
            <input asp-for="Logradouro" />
            <span asp-validation-for="Logradouro"></span>
            <br />

            <label for="Numero">Insira o número da residência</label>
            <input asp-for="Numero" />
            <span asp-validation-for="Numero"></span>
            <br />

            <label for="Cidade">Insira a sua cidade</label>
            <input asp-for="Cidade" />
            <span asp-validation-for="Cidade"></span>
            <br />

            <label for="Estado">Insira o seu Estado</label>
            <input asp-for="Estado" />
            <span asp-validation-for="Estado"></span>
            <br />

            <label for="LoginUsuario">Insira seu usuario</label>
            <input asp-for="LoginUsuario" />
            <span asp-validation-for="LoginUsuario"></span>
            <br />

            <label for="Senha">Insira sua senha</label>
            <input asp-for="Senha" />
            <span asp-validation-for="Senha"></span>
            <br />

            <div class="image-upload-wrapper">
                <label for="Imagem" class="botao-upload">
                    <i class="fas fa-upload"></i> Escolha sua foto de perfil
                    @* Ícone opcional, requer Font Awesome ou similar *@
                </label>
                <input type="file" name="Imagem" id="Imagem" onchange="exibirImagem()">
                <img id="imgPreview" src="data:image/jpeg;base64,@Model.ImagemEmBase64" width="100">
                <span asp-validation-for="Imagem"></span>
            </div>

            <br />
            <input type="submit" value="Finalizar cadastro" />
            <br />
        </div>
        
    </form>
</div>


<script>
        function exibirImagem() {
        var input = document.getElementById("Imagem");
        var preview = document.getElementById("imgPreview");
        var fileNameSpan = document.getElementById("nome-arquivo"); // Pega o span do nome

        // Verifica se há arquivos selecionados
        if (input.files && input.files[0]) {
            var oFReader = new FileReader();
            oFReader.readAsDataURL(input.files[0]);

            oFReader.onload = function (oFREvent) {
                preview.src = oFREvent.target.result;
                preview.style.display = 'inline-block'; // Mostra a imagem
            };

            fileNameSpan.textContent = input.files[0].name; // Mostra o nome do arquivo
        } else {
            fileNameSpan.textContent = "Nenhum arquivo selecionado"; // Texto padrão
            preview.src = ""; // Limpa o src
            preview.style.display = 'none'; // Esconde a imagem
        }
    }

    // Para garantir que a imagem apareça (ou não) ao carregar a página (no caso de edição)
    document.addEventListener("DOMContentLoaded", function() {
        var preview = document.getElementById("imgPreview");
        // Verifica se o src tem algo além do prefixo 'data:image' ou se não está vazio
        if (preview.src && !preview.src.endsWith("base64,") && preview.src.includes("data:image")) {
            preview.style.display = 'inline-block';
        } else {
            preview.style.display = 'none';
        }
    });
</script>